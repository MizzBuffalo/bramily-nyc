<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bramily NYC Trip Coordinator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.95;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #ccc;
            font-weight: 500;
        }
        
        .required::after {
            content: " *";
            color: #ff6b6b;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.12);
        }
        
        select option {
            background: #2a2a3e;
            color: #fff;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        button {
            padding: 14px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .list-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-item:hover {
            background: rgba(255,255,255,0.08);
        }
        
        .list-item-content {
            flex: 1;
        }
        
        .delete-btn {
            padding: 8px 16px;
            background: #dc3545;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 15px;
            flex-shrink: 0;
        }
        
        .delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        .item-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .item-details {
            font-size: 15px;
            color: #ccc;
            line-height: 1.8;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 16px;
            color: #ccc;
        }
        
        .section-group {
            margin-bottom: 30px;
        }
        
        .section-header {
            background: rgba(102, 126, 234, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        
        .export-btn {
            background: #28a745;
            margin-top: 20px;
        }
        
        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }
        
        .refresh-btn {
            background: #17a2b8;
            margin-right: 10px;
        }
        
        .success-message {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            color: #28a745;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .night-section {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .night-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .match-badge {
            display: inline-block;
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid #28a745;
            color: #28a745;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .time-group-header {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 20px 0 10px 0;
            font-weight: 600;
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∏ Bramily NYC Trip Coordinator üóΩ</h1>
            <p class="subtitle">Brandi Carlile @ MSG ‚Ä¢ Feb 13-14, 2026</p>
        </div>
        
        <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
            <div onclick="document.getElementById('changelogContent').classList.toggle('hidden'); this.querySelector('.arrow').textContent = document.getElementById('changelogContent').classList.contains('hidden') ? '‚ñ∂' : '‚ñº';" style="padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 600; color: #667eea; font-size: 16px;">üìã Changelog</span>
                <span class="arrow" style="color: #667eea; font-size: 14px;">‚ñ∂</span>
            </div>
            <div id="changelogContent" class="hidden" style="padding: 0 20px 20px 20px; border-top: 1px solid rgba(102, 126, 234, 0.2);">
                <div style="padding-top: 15px; font-size: 14px; color: #ccc; line-height: 1.8;">
                    
                    <div style="color: #667eea; font-weight: 700; font-size: 15px; margin-bottom: 8px;">v2.5 ‚Äî Latest</div>
                    <div style="margin-left: 12px; margin-bottom: 18px;">
                        ‚úÖ Hotel field no longer required ‚Äî locals can skip it<br>
                        üèôÔ∏è Added "I'm Local / N/A" hotel option for NYC-based Bramily<br>
                        üëÄ Smart form ‚Äî ride share fields only appear when you select "Yes," hotel dates hide for locals<br>
                        üî† Names auto-capitalize (no more lowercase entries)<br>
                        üìã Directory tab now shows people count<br>
                        üì± Full-width submit button for easier tapping on mobile<br>
                        üìã Added this changelog!
                    </div>

                    <div style="color: #667eea; font-weight: 700; font-size: 15px; margin-bottom: 8px;">v2.0 ‚Äî Ride Share Overhaul</div>
                    <div style="margin-left: 12px; margin-bottom: 18px;">
                        üöï Ride Share tab completely redesigned ‚Äî no more "Offering" vs "Looking," just opt in to match with others for shared taxis/Ubers<br>
                        ‚úÖ Confirmation popup shows full info summary before submitting<br>
                        ‚ö†Ô∏è Added warning banner reminding people to double-check their info<br>
                        üìÖ Fixed "Invalid Date" bug ‚Äî dates now display correctly regardless of how Google Sheets formats them<br>
                        üì± Increased text sizes and brightened colors for better readability on mobile/iPad<br>
                        üîÑ Fixed refresh button so it stays on current tab instead of jumping back to "Add Your Info"<br>
                        üîß Fixed rideshare tab div ID conflict that was preventing data from displaying<br>
                        üïê People who opt in to ride share but haven't set times now show under "Times TBD" instead of being hidden<br>
                        üìä Dates now show friendly format like "Sun, Feb 15" instead of raw numbers
                    </div>

                    <div style="color: #667eea; font-weight: 700; font-size: 15px; margin-bottom: 8px;">v1.5 ‚Äî Form & Data Improvements</div>
                    <div style="margin-left: 12px; margin-bottom: 18px;">
                        üé∏ Separate Friday & Saturday seating sections for people attending both nights<br>
                        üé≠ VIP package tracking per night (Soundcheck & Big Night Out)<br>
                        üîß Fixed ID conflicts between section divs and input fields (fridaySection vs fridaySectionInput)<br>
                        üî§ Section field now accepts both letters (A-F) and numbers (116, 201, 310)<br>
                        ‚¨ÜÔ∏è Auto-uppercase conversion for section entries<br>
                        üìù Better error messages ‚Äî now lists which specific fields are missing<br>
                        üóëÔ∏è Delete functionality added in Directory tab<br>
                        üìÖ Switched to separate date and time pickers for arrival/departure<br>
                        üè® Hotels grouped by check-in date within each hotel<br>
                        ‚≠ê Ride share auto-groups people within 1 hour and shows "Good Match" labels
                    </div>

                    <div style="color: #667eea; font-weight: 700; font-size: 15px; margin-bottom: 8px;">v1.0 ‚Äî Initial Launch</div>
                    <div style="margin-left: 12px; margin-bottom: 18px;">
                        üéâ Site launched!<br>
                        üìù Form for name, contact, seating, hotel, rideshare, and notes<br>
                        üé≠ Seating tab organized by night and section<br>
                        üè® Hotel tab with grouping<br>
                        üöó Rideshare tab with airport grouping<br>
                        üìã Complete directory sorted alphabetically<br>
                        üì§ Export buttons for copying formatted text to clipboard<br>
                        üîÑ Refresh buttons on every tab<br>
                        üíæ Google Sheets backend with Apps Script API<br>
                        üåê Hosted on GitHub Pages
                    </div>

                    <div style="color: #888; font-size: 12px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
                        Built with üíú for the Bramily by Amy
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('form')">‚ûï Add Your Info</button>
            <button class="tab-btn" onclick="showTab('seating')">üé≠ Seating</button>
            <button class="tab-btn" onclick="showTab('hotels')">üè® Hotels</button>
            <button class="tab-btn" onclick="showTab('rideshare')">üöï Ride Share</button>
            <button class="tab-btn" onclick="showTab('directory')">üìã Directory</button>
        </div>
        
        <!-- ADD INFO TAB -->
        <div id="form" class="tab-content active">
            <div class="card">
                <h2>Add Your Trip Information</h2>
                
                <div id="successMessage" class="success-message" style="display: none;">
                    ‚ú® Successfully added! Check the other tabs to see everyone!
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">Your Name</label>
                        <input type="text" id="name" placeholder="Enter your name">
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Contact Info</label>
                        <input type="text" id="contact" placeholder="Email, phone, or Instagram">
                        <div class="help-text">So people can reach you!</div>
                    </div>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px 0;">Concert Info</h3>
                
                <div class="form-group">
                    <label class="required">Which Night(s)?</label>
                    <select id="nightSelection" onchange="updateNightFields()">
                        <option value="">-- Select Night --</option>
                        <option value="friday">Friday 2/13 only</option>
                        <option value="saturday">Saturday 2/14 only</option>
                        <option value="both">Both nights! üéâ</option>
                    </select>
                </div>
                
                <!-- FRIDAY NIGHT SECTION -->
                <div id="fridaySection" class="night-section hidden">
                    <h3>üé∏ Friday, February 13</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">Section</label>
                            <input type="text" id="fridaySectionInput" placeholder="e.g., 116, A, 201, 310">
                            <div class="help-text">Letters (A-F) or numbers</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Row</label>
                            <input type="text" id="fridayRow" placeholder="If you know it">
                        </div>
                        
                        <div class="form-group">
                            <label>Seat</label>
                            <input type="text" id="fridaySeat" placeholder="If you know it">
                        </div>
                        
                        <div class="form-group">
                            <label>VIP Package</label>
                            <select id="fridayVIP">
                                <option value="none">None (regular ticket)</option>
                                <option value="soundcheck">Soundcheck Only</option>
                                <option value="bignight">Big Night Out</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- SATURDAY NIGHT SECTION -->
                <div id="saturdaySection" class="night-section hidden">
                    <h3>üé∏ Saturday, February 14</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">Section</label>
                            <input type="text" id="saturdaySectionInput" placeholder="e.g., 116, A, 201, 310">
                            <div class="help-text">Letters (A-F) or numbers</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Row</label>
                            <input type="text" id="saturdayRow" placeholder="If you know it">
                        </div>
                        
                        <div class="form-group">
                            <label>Seat</label>
                            <input type="text" id="saturdaySeat" placeholder="If you know it">
                        </div>
                        
                        <div class="form-group">
                            <label>VIP Package</label>
                            <select id="saturdayVIP">
                                <option value="none">None (regular ticket)</option>
                                <option value="soundcheck">Soundcheck Only</option>
                                <option value="bignight">Big Night Out</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px 0;">Hotel Info</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Where Are You Staying?</label>
                        <select id="hotel" onchange="toggleHotelFields()">
                            <option value="">-- Select if applicable --</option>
                            <option value="springhill">SpringHill Suites by Marriott</option>
                            <option value="courtyard">Courtyard by Marriott</option>
                            <option value="other">Other hotel</option>
                            <option value="local">I'm local / N/A üèôÔ∏è</option>
                            <option value="friends">Staying with friends/family</option>
                            <option value="none">Not staying overnight</option>
                        </select>
                    </div>
                    
                    <div class="form-group hidden" id="otherHotelGroup">
                        <label>Other Hotel Name</label>
                        <input type="text" id="otherHotel" placeholder="Enter your hotel name">
                    </div>
                </div>
                
                <div id="hotelDatesGroup" class="hidden">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Check-in Date</label>
                            <input type="date" id="checkin">
                        </div>
                        
                        <div class="form-group">
                            <label>Check-out Date</label>
                            <input type="date" id="checkout">
                        </div>
                    </div>
                </div>
                
                <h3 style="color: #667eea; margin: 30px 0 15px 0;">Airport Ride Sharing</h3>
                <p style="color: #aaa; margin-bottom: 15px; font-size: 14px;">Want to split a taxi or Uber to/from the airport with other Bramily members? Add your travel details and we'll match you with people on similar schedules!</p>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Want to Share a Ride?</label>
                        <select id="rideshare" onchange="toggleRideshareFields()">
                            <option value="no">No thanks</option>
                            <option value="yes">Yes - match me with others! üöï</option>
                        </select>
                    </div>
                </div>
                
                <div id="rideshareFields" class="hidden">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Which Airport?</label>
                            <select id="airport">
                                <option value="">-- Select Airport --</option>
                                <option value="jfk">JFK (John F. Kennedy)</option>
                                <option value="lga">LaGuardia (LGA)</option>
                                <option value="ewr">Newark (EWR)</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Arrival Date & Time</label>
                        <div class="datetime-group">
                            <input type="date" id="arrivalDate">
                            <input type="time" id="arrivalTime">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Departure Date & Time</label>
                        <div class="datetime-group">
                            <input type="date" id="departureDate">
                            <input type="time" id="departureTime">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="notes" placeholder="Anything else the Bramily should know?"></textarea>
                </div>
                
                <div style="background: rgba(255, 193, 7, 0.1); border: 2px solid rgba(255, 193, 7, 0.5); border-radius: 10px; padding: 15px; margin: 20px 0; text-align: center;">
                    <p style="color: #ffc107; font-weight: 600; margin: 0;">‚ö†Ô∏è Please double-check your information before submitting. Questions? Contact Amy.</p>
                </div>
                
                <button id="submitBtn" onclick="addPerson()" style="width: 100%; padding: 18px; font-size: 18px;">‚ú® Add Me to the Trip!</button>
            </div>
        </div>
        
        <!-- SEATING TAB -->
        <div id="seating" class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Total People</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statFriday">0</div>
                    <div class="stat-label">Friday Night</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statSaturday">0</div>
                    <div class="stat-label">Saturday Night</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statBoth">0</div>
                    <div class="stat-label">Both Nights</div>
                </div>
            </div>
            
            <div class="card">
                <h2>üé≠ Seating by Night & Section</h2>
                <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
                <button class="export-btn" onclick="exportSeating()">üìã Export Seating List</button>
                <div id="seatingList"></div>
            </div>
        </div>
        
        <!-- HOTELS TAB -->
        <div id="hotels" class="tab-content">
            <div class="card">
                <h2>üè® Hotel Groups</h2>
                <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
                <button class="export-btn" onclick="exportHotels()">üìã Export Hotel List</button>
                <div id="hotelsList"></div>
            </div>
        </div>
        
        <!-- RIDESHARE TAB -->
        <div id="rideshareTab" class="tab-content">
            <div class="card">
                <h2>üöï Airport Ride Sharing</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Find Bramily members on similar schedules to split a taxi or Uber to/from the airport! People arriving or departing within an hour of each other are highlighted as ‚≠ê Good Matches.</p>
                <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
                <button class="export-btn" onclick="exportRideshare()">üìã Export Ride Share List</button>
                <div id="rideshareList"></div>
            </div>
        </div>
        
        <!-- DIRECTORY TAB -->
        <div id="directory" class="tab-content">
            <div class="card">
                <h2>üìã Complete Directory (<span id="directoryCount">0</span> people)</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Everyone who's added their info - sorted alphabetically</p>
                <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
                <button class="export-btn" onclick="exportAll()">üìã Export Complete List</button>
                <div id="directoryList"></div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyd0yVmIKxkCXVnUlAigzvMe0byRLaYJScmX1OBZPiWl4oelYsypfJE7LBmHk5WXg03/exec';
        let people = [];
        
        // Helper: normalize a date value from Google Sheets into "YYYY-MM-DD"
        function normalizeDate(val) {
            if (!val) return '';
            const s = String(val).trim();
            if (!s) return '';
            // Already YYYY-MM-DD?
            if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;
            // Try parsing as a date
            const d = new Date(s);
            if (!isNaN(d.getTime())) {
                const yyyy = d.getFullYear();
                const mm = String(d.getMonth() + 1).padStart(2, '0');
                const dd = String(d.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            }
            return s;
        }
        
        // Helper: normalize a time value from Google Sheets into "HH:MM"
        function normalizeTime(val) {
            if (!val) return '';
            const s = String(val).trim();
            if (!s) return '';
            // Already HH:MM or HH:MM:SS?
            if (/^\d{1,2}:\d{2}(:\d{2})?$/.test(s)) return s.substring(0, 5);
            // Google Sheets might send time as a date string like "1899-12-30T21:33:00.000Z"
            const d = new Date(s);
            if (!isNaN(d.getTime())) {
                const hh = String(d.getHours()).padStart(2, '0');
                const mm = String(d.getMinutes()).padStart(2, '0');
                return `${hh}:${mm}`;
            }
            return s;
        }
        
        // Helper: create a valid Date object from a date string and time string
        function parseDateTime(dateStr, timeStr) {
            if (!dateStr || !timeStr) return null;
            const d = new Date(dateStr + 'T' + timeStr);
            if (!isNaN(d.getTime())) return d;
            // Fallback
            const d2 = new Date(dateStr + ' ' + timeStr);
            if (!isNaN(d2.getTime())) return d2;
            return null;
        }
        
        // Helper: format a Date for display
        function formatDateTime(dt, prefix) {
            if (!dt || isNaN(dt.getTime())) return prefix + ' date/time TBD';
            return `${prefix} ${dt.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'})} at ${dt.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        }
        
        // Show/hide night sections based on selection
        function updateNightFields() {
            const selection = document.getElementById('nightSelection').value;
            const fridayDiv = document.getElementById('fridaySection');
            const saturdayDiv = document.getElementById('saturdaySection');
            
            fridayDiv.classList.add('hidden');
            saturdayDiv.classList.add('hidden');
            
            if (selection === 'friday' || selection === 'both') {
                fridayDiv.classList.remove('hidden');
            }
            if (selection === 'saturday' || selection === 'both') {
                saturdayDiv.classList.remove('hidden');
            }
        }
        
        // Show/hide hotel fields based on selection
        function toggleHotelFields() {
            const hotel = document.getElementById('hotel').value;
            const otherGroup = document.getElementById('otherHotelGroup');
            const datesGroup = document.getElementById('hotelDatesGroup');
            
            otherGroup.classList.toggle('hidden', hotel !== 'other');
            datesGroup.classList.toggle('hidden', hotel === '' || hotel === 'none' || hotel === 'local');
        }
        
        // Show/hide rideshare detail fields
        function toggleRideshareFields() {
            const rideshare = document.getElementById('rideshare').value;
            document.getElementById('rideshareFields').classList.toggle('hidden', rideshare !== 'yes');
        }
        
        // Capitalize each word in a name
        function capitalizeName(name) {
            return name.replace(/\b\w/g, c => c.toUpperCase());
        }
        
        // Load data from Google Sheets
        async function loadData() {
            try {
                const response = await fetch(SHEET_URL);
                const data = await response.json();
                people = data.map(row => {
                    const get = (key) => {
                        if (row[key] !== undefined && row[key] !== null) return String(row[key]).trim();
                        const lk = key.toLowerCase();
                        for (const k in row) {
                            if (k.toLowerCase() === lk) return String(row[k]).trim();
                        }
                        return '';
                    };
                    
                    let rideshareVal = get('Rideshare').toLowerCase();
                    if (rideshareVal === 'offering' || rideshareVal === 'looking') rideshareVal = 'yes';
                    
                    return {
                        name: capitalizeName(get('Name')),
                        contact: get('Contact'),
                        nights: get('Nights').toLowerCase(),
                        fridaySection: get('FridaySection'),
                        fridayRow: get('FridayRow'),
                        fridaySeat: get('FridaySeat'),
                        fridayVIP: get('FridayVIP').toLowerCase(),
                        saturdaySection: get('SaturdaySection'),
                        saturdayRow: get('SaturdayRow'),
                        saturdaySeat: get('SaturdaySeat'),
                        saturdayVIP: get('SaturdayVIP').toLowerCase(),
                        hotel: get('Hotel').toLowerCase(),
                        otherHotel: get('OtherHotel'),
                        rideshare: rideshareVal,
                        airport: get('Airport').toLowerCase(),
                        arrivalDate: normalizeDate(get('ArrivalDate')),
                        arrivalTime: normalizeTime(get('ArrivalTime')),
                        departureDate: normalizeDate(get('DepartureDate')),
                        departureTime: normalizeTime(get('DepartureTime')),
                        checkin: normalizeDate(get('CheckIn')),
                        checkout: normalizeDate(get('CheckOut')),
                        notes: get('Notes')
                    };
                });
                console.log('=== DATA LOAD ===', people.length, 'people loaded');
                if (data.length > 0) console.log('Sheet columns:', Object.keys(data[0]));
                render();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        // Tab switching
        let currentTab = 'form';
        
        function showTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            const tabDivId = tabName === 'rideshare' ? 'rideshareTab' : tabName;
            document.getElementById(tabDivId).classList.add('active');
            
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabIndex = ['form', 'seating', 'hotels', 'rideshare', 'directory'].indexOf(tabName);
            if (tabIndex >= 0 && tabButtons[tabIndex]) {
                tabButtons[tabIndex].classList.add('active');
            }
            
            loadData();
        }
        
        // Add person to Google Sheets
        async function addPerson() {
            const nightSelection = document.getElementById('nightSelection').value;
            
            if (!nightSelection) {
                alert('Please select which night(s) you are attending');
                return;
            }
            
            const data = {
                name: capitalizeName(document.getElementById('name').value.trim()),
                contact: document.getElementById('contact').value.trim(),
                nights: nightSelection,
                fridaySection: document.getElementById('fridaySectionInput').value.trim().toUpperCase(),
                fridayRow: document.getElementById('fridayRow').value.trim(),
                fridaySeat: document.getElementById('fridaySeat').value.trim(),
                fridayVIP: document.getElementById('fridayVIP').value,
                saturdaySection: document.getElementById('saturdaySectionInput').value.trim().toUpperCase(),
                saturdayRow: document.getElementById('saturdayRow').value.trim(),
                saturdaySeat: document.getElementById('saturdaySeat').value.trim(),
                saturdayVIP: document.getElementById('saturdayVIP').value,
                hotel: document.getElementById('hotel').value,
                otherHotel: document.getElementById('otherHotel').value.trim(),
                checkin: document.getElementById('checkin').value,
                checkout: document.getElementById('checkout').value,
                rideshare: document.getElementById('rideshare').value,
                airport: document.getElementById('airport').value,
                arrivalDate: document.getElementById('arrivalDate').value,
                arrivalTime: document.getElementById('arrivalTime').value,
                departureDate: document.getElementById('departureDate').value,
                departureTime: document.getElementById('departureTime').value,
                notes: document.getElementById('notes').value.trim()
            };
            
            // Validate required fields based on night selection
            const missing = [];
            if (!data.name) missing.push('Name');
            if (!data.contact) missing.push('Contact Info');
            
            if (nightSelection === 'friday' || nightSelection === 'both') {
                if (!data.fridaySection) missing.push('Friday Section');
            }
            
            if (nightSelection === 'saturday' || nightSelection === 'both') {
                if (!data.saturdaySection) missing.push('Saturday Section');
            }
            
            if (missing.length > 0) {
                alert('Please fill in these required fields:\n‚Ä¢ ' + missing.join('\n‚Ä¢ '));
                return;
            }
            
            // Build confirmation summary
            const nightText = data.nights === 'both' ? 'Both nights' : 
                             data.nights === 'friday' ? 'Friday 2/13 only' : 'Saturday 2/14 only';
            
            const hotelText = data.hotel === 'springhill' ? 'SpringHill Suites' : 
                             data.hotel === 'courtyard' ? 'Courtyard by Marriott' :
                             data.hotel === 'other' ? (data.otherHotel || 'Other hotel') :
                             data.hotel === 'local' ? 'Local / N/A' :
                             data.hotel === 'friends' ? 'Friends/Family' : 
                             data.hotel === 'none' ? 'Not staying overnight' : 'Not specified';
            
            let seatSummary = '';
            if (data.nights === 'friday' || data.nights === 'both') {
                seatSummary += `  üé∏ Friday: Section ${data.fridaySection}`;
                if (data.fridayRow) seatSummary += `, Row ${data.fridayRow}`;
                if (data.fridaySeat) seatSummary += `, Seat ${data.fridaySeat}`;
                if (data.fridayVIP !== 'none') seatSummary += ` (VIP: ${data.fridayVIP === 'soundcheck' ? 'Soundcheck' : 'Big Night Out'})`;
                seatSummary += '\n';
            }
            if (data.nights === 'saturday' || data.nights === 'both') {
                seatSummary += `  üé∏ Saturday: Section ${data.saturdaySection}`;
                if (data.saturdayRow) seatSummary += `, Row ${data.saturdayRow}`;
                if (data.saturdaySeat) seatSummary += `, Seat ${data.saturdaySeat}`;
                if (data.saturdayVIP !== 'none') seatSummary += ` (VIP: ${data.saturdayVIP === 'soundcheck' ? 'Soundcheck' : 'Big Night Out'})`;
                seatSummary += '\n';
            }
            
            let rideSummary = '';
            if (data.rideshare === 'yes') {
                const airportName = data.airport === 'jfk' ? 'JFK' : data.airport === 'lga' ? 'LaGuardia' : data.airport === 'ewr' ? 'Newark' : data.airport || 'TBD';
                rideSummary = `  üöï Ride share: Yes (${airportName})\n`;
                if (data.arrivalDate && data.arrivalTime) rideSummary += `     Arriving: ${data.arrivalDate} at ${data.arrivalTime}\n`;
                if (data.departureDate && data.departureTime) rideSummary += `     Departing: ${data.departureDate} at ${data.departureTime}\n`;
            }
            
            const summary = `Please confirm your info:\n\n` +
                `  üë§ ${data.name}\n` +
                `  üìû ${data.contact}\n` +
                `  üìÖ ${nightText}\n` +
                seatSummary +
                `  üè® ${hotelText}\n` +
                (data.checkin ? `     Check-in: ${data.checkin}\n` : '') +
                (data.checkout ? `     Check-out: ${data.checkout}\n` : '') +
                rideSummary +
                (data.notes ? `  üìù ${data.notes}\n` : '') +
                `\nDoes everything look correct?`;
            
            if (!confirm(summary)) {
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Adding...';
            
            try {
                const response = await fetch(SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // Clear form
                document.querySelectorAll('input[type="text"], input[type="date"], input[type="time"], textarea').forEach(el => el.value = '');
                document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
                updateNightFields();
                toggleHotelFields();
                toggleRideshareFields();
                
                // Show success message
                const successMsg = document.getElementById('successMessage');
                successMsg.style.display = 'block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 5000);
                
                setTimeout(() => loadData(), 2000);
                
            } catch (error) {
                alert('Error adding to sheet. Please try again.');
                console.error('Error:', error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚ú® Add Me to the Trip!';
            }
        }
        
        // Render all views
        function render() {
            renderStats();
            renderSeating();
            renderHotels();
            renderRideshare();
            renderDirectory();
        }
        
        function renderStats() {
            const uniquePeople = new Set(people.map(p => p.name));
            document.getElementById('statTotal').textContent = uniquePeople.size;
            document.getElementById('statFriday').textContent = people.filter(p => p.nights === 'friday' || p.nights === 'both').length;
            document.getElementById('statSaturday').textContent = people.filter(p => p.nights === 'saturday' || p.nights === 'both').length;
            document.getElementById('statBoth').textContent = people.filter(p => p.nights === 'both').length;
        }
        
        function renderSeating() {
            let html = '';
            
            // Friday Night
            const fridayPeople = people.filter(p => p.nights === 'friday' || p.nights === 'both');
            if (fridayPeople.length > 0) {
                html += '<div class="section-group"><h3 style="color: #667eea; font-size: 24px; margin-bottom: 20px;">üé∏ Friday, February 13</h3>';
                
                const fridaySections = {};
                fridayPeople.forEach(p => {
                    if (!p.fridaySection) return;
                    if (!fridaySections[p.fridaySection]) fridaySections[p.fridaySection] = [];
                    fridaySections[p.fridaySection].push(p);
                });
                
                Object.keys(fridaySections).sort().forEach(sec => {
                    html += `<div class="section-header">Section ${sec} (${fridaySections[sec].length})</div>`;
                    fridaySections[sec].forEach(p => {
                        const seatInfo = p.fridayRow && p.fridaySeat ? `Row ${p.fridayRow}, Seat ${p.fridaySeat}` : 
                                         p.fridayRow ? `Row ${p.fridayRow}` : 
                                         p.fridaySeat ? `Seat ${p.fridaySeat}` : 'Seat TBD';
                        const vipText = p.fridayVIP === 'soundcheck' ? ' ‚Ä¢ VIP Soundcheck' : 
                                       p.fridayVIP === 'bignight' ? ' ‚Ä¢ VIP Big Night Out' : '';
                        
                        html += `<div class="list-item">
                            <div class="item-name">${p.name}</div>
                            <div class="item-details">${seatInfo}${vipText}<br>üìû ${p.contact}</div>
                        </div>`;
                    });
                });
                html += '</div>';
            }
            
            // Saturday Night
            const saturdayPeople = people.filter(p => p.nights === 'saturday' || p.nights === 'both');
            if (saturdayPeople.length > 0) {
                html += '<div class="section-group"><h3 style="color: #667eea; font-size: 24px; margin-bottom: 20px;">üé∏ Saturday, February 14</h3>';
                
                const saturdaySections = {};
                saturdayPeople.forEach(p => {
                    if (!p.saturdaySection) return;
                    if (!saturdaySections[p.saturdaySection]) saturdaySections[p.saturdaySection] = [];
                    saturdaySections[p.saturdaySection].push(p);
                });
                
                Object.keys(saturdaySections).sort().forEach(sec => {
                    html += `<div class="section-header">Section ${sec} (${saturdaySections[sec].length})</div>`;
                    saturdaySections[sec].forEach(p => {
                        const seatInfo = p.saturdayRow && p.saturdaySeat ? `Row ${p.saturdayRow}, Seat ${p.saturdaySeat}` : 
                                         p.saturdayRow ? `Row ${p.saturdayRow}` : 
                                         p.saturdaySeat ? `Seat ${p.saturdaySeat}` : 'Seat TBD';
                        const vipText = p.saturdayVIP === 'soundcheck' ? ' ‚Ä¢ VIP Soundcheck' : 
                                       p.saturdayVIP === 'bignight' ? ' ‚Ä¢ VIP Big Night Out' : '';
                        
                        html += `<div class="list-item">
                            <div class="item-name">${p.name}</div>
                            <div class="item-details">${seatInfo}${vipText}<br>üìû ${p.contact}</div>
                        </div>`;
                    });
                });
                html += '</div>';
            }
            
            document.getElementById('seatingList').innerHTML = html || '<div class="empty-state">üé≠ No one added yet! Be the first!</div>';
        }
        
        function renderHotels() {
            const hotels = {
                'springhill': [],
                'courtyard': [],
                'other': [],
                'none': [],
                'local': [],
                'friends': []
            };
            
            people.forEach(p => {
                if (p.hotel && hotels[p.hotel]) {
                    hotels[p.hotel].push(p);
                }
            });
            
            const hotelNames = {
                'springhill': 'üè® SpringHill Suites by Marriott',
                'courtyard': 'üè® Courtyard by Marriott',
                'other': 'üè® Other Hotels',
                'none': 'üö´ Not Staying Overnight',
                'local': 'üèôÔ∏è Local / N/A',
                'friends': 'üè† Staying with Friends/Family'
            };
            
            let html = '';
            Object.keys(hotels).forEach(key => {
                if (hotels[key].length === 0) return;
                
                // Group by check-in date within each hotel
                const byCheckin = {};
                hotels[key].forEach(p => {
                    const checkin = p.checkin || 'Date TBD';
                    if (!byCheckin[checkin]) byCheckin[checkin] = [];
                    byCheckin[checkin].push(p);
                });
                
                html += `<div class="section-group">
                    <div class="section-header">${hotelNames[key]} (${hotels[key].length})</div>`;
                
                Object.keys(byCheckin).sort().forEach(checkinDate => {
                    if (Object.keys(byCheckin).length > 1) {
                        const ciDisplay = checkinDate === 'Date TBD' ? checkinDate : new Date(checkinDate + 'T00:00:00').toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'});
                        html += `<div class="time-group-header">Check-in: ${ciDisplay} (${byCheckin[checkinDate].length})</div>`;
                    }
                    
                    byCheckin[checkinDate].forEach(p => {
                        let dates = 'Dates TBD';
                        if (p.checkin && p.checkout) {
                            const ci = new Date(p.checkin + 'T00:00:00');
                            const co = new Date(p.checkout + 'T00:00:00');
                            if (!isNaN(ci) && !isNaN(co)) {
                                const opts = {weekday: 'short', month: 'short', day: 'numeric'};
                                dates = `${ci.toLocaleDateString('en-US', opts)} - ${co.toLocaleDateString('en-US', opts)}`;
                            }
                        }
                        const hotelName = p.hotel === 'other' && p.otherHotel ? ` - ${p.otherHotel}` : '';
                        
                        html += `<div class="list-item">
                            <div>
                                <div class="item-name">${p.name}</div>
                                <div class="item-details">üìÖ ${dates}${hotelName}<br>üìû ${p.contact}</div>
                            </div>
                        </div>`;
                    });
                });
                
                html += '</div>';
            });
            
            document.getElementById('hotelsList').innerHTML = html || '<div class="empty-state">üè® No one added hotel info yet!</div>';
        }
        
        function renderRideshare() {
            const rideshareNeeded = people.filter(p => {
                const rs = (p.rideshare || '').toString().trim().toLowerCase();
                return rs === 'yes' || rs === 'offering' || rs === 'looking';
            });
            
            if (rideshareNeeded.length === 0) {
                document.getElementById('rideshareList').innerHTML = '<div class="empty-state">üöï No one has signed up for ride sharing yet! Be the first!</div>';
                return;
            }
            
            const byAirport = {};
            rideshareNeeded.forEach(p => {
                const airport = (p.airport || 'tbd').toString().trim().toLowerCase() || 'tbd';
                if (!byAirport[airport]) byAirport[airport] = { arrivals: [], departures: [], noTimes: [] };
                
                const hasArrival = p.arrivalDate && p.arrivalTime;
                const hasDeparture = p.departureDate && p.departureTime;
                
                if (hasArrival) byAirport[airport].arrivals.push(p);
                if (hasDeparture) byAirport[airport].departures.push(p);
                if (!hasArrival && !hasDeparture) byAirport[airport].noTimes.push(p);
            });
            
            const airportNames = {
                'jfk': '‚úàÔ∏è JFK (John F. Kennedy)',
                'lga': '‚úàÔ∏è LaGuardia (LGA)',
                'ewr': '‚úàÔ∏è Newark (EWR)',
                'other': '‚úàÔ∏è Other Airport',
                'tbd': '‚úàÔ∏è Airport TBD'
            };
            
            let html = '';
            
            Object.keys(byAirport).forEach(airport => {
                const totalAtAirport = new Set([
                    ...byAirport[airport].arrivals.map(p => p.name),
                    ...byAirport[airport].departures.map(p => p.name),
                    ...byAirport[airport].noTimes.map(p => p.name)
                ]).size;
                
                html += `<div class="section-group"><div class="section-header">${airportNames[airport] || '‚úàÔ∏è ' + airport.toUpperCase()} (${totalAtAirport} people)</div>`;
                
                if (byAirport[airport].arrivals.length > 0) {
                    html += '<h4 style="color: #667eea; margin: 20px 0 15px 0; font-size: 18px;">üõ¨ ARRIVALS</h4>';
                    
                    const arrivals = byAirport[airport].arrivals.sort((a, b) => {
                        const aT = parseDateTime(a.arrivalDate, a.arrivalTime);
                        const bT = parseDateTime(b.arrivalDate, b.arrivalTime);
                        return (aT || 0) - (bT || 0);
                    });
                    
                    const groups = [];
                    arrivals.forEach(p => {
                        const pTime = parseDateTime(p.arrivalDate, p.arrivalTime);
                        let added = false;
                        for (let group of groups) {
                            const groupTime = parseDateTime(group[0].arrivalDate, group[0].arrivalTime);
                            if (pTime && groupTime && Math.abs(pTime - groupTime) / 60000 <= 60) { group.push(p); added = true; break; }
                        }
                        if (!added) groups.push([p]);
                    });
                    
                    groups.forEach(group => {
                        if (group.length > 1) {
                            const firstTime = parseDateTime(group[0].arrivalDate, group[0].arrivalTime);
                            const lastTime = parseDateTime(group[group.length-1].arrivalDate, group[group.length-1].arrivalTime);
                            if (firstTime && lastTime) {
                                html += `<div class="time-group-header">‚≠ê GOOD MATCH - ${group.length} people arriving ${firstTime.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'})} around ${firstTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${lastTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`;
                            }
                        }
                        group.forEach(p => {
                            const datetime = parseDateTime(p.arrivalDate, p.arrivalTime);
                            html += `<div class="list-item"><div>
                                <div class="item-name">${p.name}</div>
                                <div class="item-details">üìÖ ${formatDateTime(datetime, 'Arriving')}<br>üìû ${p.contact}</div>
                            </div></div>`;
                        });
                    });
                }
                
                if (byAirport[airport].departures.length > 0) {
                    html += '<h4 style="color: #667eea; margin: 20px 0 15px 0; font-size: 18px;">üõ´ DEPARTURES</h4>';
                    
                    const departures = byAirport[airport].departures.sort((a, b) => {
                        const aT = parseDateTime(a.departureDate, a.departureTime);
                        const bT = parseDateTime(b.departureDate, b.departureTime);
                        return (aT || 0) - (bT || 0);
                    });
                    
                    const groups = [];
                    departures.forEach(p => {
                        const pTime = parseDateTime(p.departureDate, p.departureTime);
                        let added = false;
                        for (let group of groups) {
                            const groupTime = parseDateTime(group[0].departureDate, group[0].departureTime);
                            if (pTime && groupTime && Math.abs(pTime - groupTime) / 60000 <= 60) { group.push(p); added = true; break; }
                        }
                        if (!added) groups.push([p]);
                    });
                    
                    groups.forEach(group => {
                        if (group.length > 1) {
                            const firstTime = parseDateTime(group[0].departureDate, group[0].departureTime);
                            const lastTime = parseDateTime(group[group.length-1].departureDate, group[group.length-1].departureTime);
                            if (firstTime && lastTime) {
                                html += `<div class="time-group-header">‚≠ê GOOD MATCH - ${group.length} people departing ${firstTime.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'})} around ${firstTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${lastTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`;
                            }
                        }
                        group.forEach(p => {
                            const datetime = parseDateTime(p.departureDate, p.departureTime);
                            html += `<div class="list-item"><div>
                                <div class="item-name">${p.name}</div>
                                <div class="item-details">üìÖ ${formatDateTime(datetime, 'Departing')}<br>üìû ${p.contact}</div>
                            </div></div>`;
                        });
                    });
                }
                
                if (byAirport[airport].noTimes.length > 0) {
                    html += '<h4 style="color: #667eea; margin: 20px 0 15px 0; font-size: 18px;">üïê TIMES TBD</h4>';
                    byAirport[airport].noTimes.forEach(p => {
                        html += `<div class="list-item"><div>
                            <div class="item-name">${p.name}</div>
                            <div class="item-details">üìÖ Travel times not yet set<br>üìû ${p.contact}</div>
                        </div></div>`;
                    });
                }
                
                html += '</div>';
            });
            
            document.getElementById('rideshareList').innerHTML = html;
        }
        
        function renderDirectory() {
            let html = '';
            const sorted = [...people].sort((a,b) => (a.name || '').localeCompare(b.name || ''));
            document.getElementById('directoryCount').textContent = sorted.length;
            
            sorted.forEach((p, index) => {
                const nightText = p.nights === 'both' ? 'Both nights' : 
                                p.nights === 'friday' ? 'Friday only' : 'Saturday only';
                                
                const hotelText = p.hotel === 'springhill' ? 'SpringHill Suites' : 
                                p.hotel === 'courtyard' ? 'Courtyard' :
                                p.hotel === 'other' ? p.otherHotel || 'Other hotel' :
                                p.hotel === 'local' ? 'Local / N/A' :
                                p.hotel === 'friends' ? 'Friends/Family' : 'Not staying';
                
                let seatText = '';
                if (p.nights === 'friday' || p.nights === 'both') {
                    seatText += `Fri: Section ${p.fridaySection} ${p.fridayRow ? 'Row ' + p.fridayRow : ''} ${p.fridaySeat ? 'Seat ' + p.fridaySeat : ''}`;
                    if (p.fridayVIP !== 'none') seatText += ` (VIP: ${p.fridayVIP === 'soundcheck' ? 'Soundcheck' : 'Big Night Out'})`;
                }
                if (p.nights === 'both') seatText += '<br>';
                if (p.nights === 'saturday' || p.nights === 'both') {
                    seatText += `Sat: Section ${p.saturdaySection} ${p.saturdayRow ? 'Row ' + p.saturdayRow : ''} ${p.saturdaySeat ? 'Seat ' + p.saturdaySeat : ''}`;
                    if (p.saturdayVIP !== 'none') seatText += ` (VIP: ${p.saturdayVIP === 'soundcheck' ? 'Soundcheck' : 'Big Night Out'})`;
                }
                
                html += `<div class="list-item">
                    <div class="list-item-content">
                        <div class="item-name">${p.name}</div>
                        <div class="item-details">
                            üé≠ ${seatText}<br>
                            üìÖ ${nightText}<br>
                            üè® ${hotelText}<br>
                            üìû ${p.contact}
                            ${p.notes ? '<br>üìù ' + p.notes : ''}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="deleteEntry('${p.name.replace(/'/g, "\\'")}')">üóëÔ∏è Delete</button>
                </div>`;
            });
            
            document.getElementById('directoryList').innerHTML = html || '<div class="empty-state">üìã No one added yet!</div>';
        }
        
        // Delete entry function
        async function deleteEntry(name) {
            if (!confirm(`Are you sure you want to delete the entry for "${name}"?\n\nThis cannot be undone. You'll need to manually delete this person's row from the Google Sheet.`)) {
                return;
            }
            
            alert(`To delete "${name}":\n\n1. Open your Google Sheet\n2. Find the row with "${name}"\n3. Right-click the row number\n4. Select "Delete row"\n5. Come back here and click "Refresh Data"\n\nNote: We can't auto-delete from the sheet for security reasons.`);
        }
        
        // Export functions (keeping original simple text exports)
        function exportSeating() {
            let text = 'üé∏ BRAMILY NYC - SEATING BY NIGHT & SECTION\n';
            text += 'Brandi Carlile @ MSG ‚Ä¢ Feb 13-14, 2026\n';
            text += '='.repeat(50) + '\n\n';
            
            const fridayPeople = people.filter(p => p.nights === 'friday' || p.nights === 'both');
            if (fridayPeople.length > 0) {
                text += 'FRIDAY, FEBRUARY 13\n' + '='.repeat(50) + '\n\n';
                const fridaySections = {};
                fridayPeople.forEach(p => {
                    if (!p.fridaySection) return;
                    if (!fridaySections[p.fridaySection]) fridaySections[p.fridaySection] = [];
                    fridaySections[p.fridaySection].push(p);
                });
                Object.keys(fridaySections).sort().forEach(sec => {
                    text += `SECTION ${sec}\n` + '-'.repeat(30) + '\n';
                    fridaySections[sec].forEach(p => {
                        const vipText = p.fridayVIP === 'soundcheck' ? ' - VIP Soundcheck' : p.fridayVIP === 'bignight' ? ' - VIP Big Night Out' : '';
                        text += `${p.name} - Row ${p.fridayRow || '?'} Seat ${p.fridaySeat || '?'}${vipText}\n  Contact: ${p.contact}\n\n`;
                    });
                    text += '\n';
                });
            }
            
            const saturdayPeople = people.filter(p => p.nights === 'saturday' || p.nights === 'both');
            if (saturdayPeople.length > 0) {
                text += '\nSATURDAY, FEBRUARY 14\n' + '='.repeat(50) + '\n\n';
                const saturdaySections = {};
                saturdayPeople.forEach(p => {
                    if (!p.saturdaySection) return;
                    if (!saturdaySections[p.saturdaySection]) saturdaySections[p.saturdaySection] = [];
                    saturdaySections[p.saturdaySection].push(p);
                });
                Object.keys(saturdaySections).sort().forEach(sec => {
                    text += `SECTION ${sec}\n` + '-'.repeat(30) + '\n';
                    saturdaySections[sec].forEach(p => {
                        const vipText = p.saturdayVIP === 'soundcheck' ? ' - VIP Soundcheck' : p.saturdayVIP === 'bignight' ? ' - VIP Big Night Out' : '';
                        text += `${p.name} - Row ${p.saturdayRow || '?'} Seat ${p.saturdaySeat || '?'}${vipText}\n  Contact: ${p.contact}\n\n`;
                    });
                    text += '\n';
                });
            }
            copyToClipboard(text);
        }
        
        function exportHotels() {
            let text = 'üè® BRAMILY NYC - HOTEL LIST\n' + '='.repeat(50) + '\n\n';
            const hotels = {'springhill': [], 'courtyard': [], 'other': [], 'none': [], 'local': [], 'friends': []};
            people.forEach(p => { if (p.hotel && hotels[p.hotel]) hotels[p.hotel].push(p); });
            const hotelNames = {'springhill': 'SpringHill Suites by Marriott', 'courtyard': 'Courtyard by Marriott', 'other': 'Other Hotels', 'none': 'Not Staying Overnight', 'local': 'Local / N/A', 'friends': 'Staying with Friends/Family'};
            Object.keys(hotels).forEach(key => {
                if (hotels[key].length === 0) return;
                text += `${hotelNames[key].toUpperCase()}\n` + '-'.repeat(30) + '\n';
                hotels[key].forEach(p => {
                    text += `${p.name}\n`;
                    if (p.checkin) text += `  Check-in: ${p.checkin}\n`;
                    if (p.checkout) text += `  Check-out: ${p.checkout}\n`;
                    text += `  Contact: ${p.contact}\n\n`;
                });
                text += '\n';
            });
            copyToClipboard(text);
        }
        
        function exportRideshare() {
            let text = 'üöï BRAMILY NYC - AIRPORT RIDE SHARING\n' + '='.repeat(50) + '\n\n';
            const riders = people.filter(p => p.rideshare === 'yes');
            if (riders.length === 0) { text += 'No one has signed up yet!\n'; copyToClipboard(text); return; }
            const byAirport = {};
            riders.forEach(p => {
                const airport = (p.airport || 'TBD').toUpperCase();
                if (!byAirport[airport]) byAirport[airport] = [];
                byAirport[airport].push(p);
            });
            Object.keys(byAirport).forEach(airport => {
                text += `${airport}\n` + '-'.repeat(30) + '\n';
                byAirport[airport].forEach(p => {
                    text += `${p.name}\n`;
                    if (p.arrivalDate && p.arrivalTime) text += `  Arriving: ${p.arrivalDate} ${p.arrivalTime}\n`;
                    if (p.departureDate && p.departureTime) text += `  Departing: ${p.departureDate} ${p.departureTime}\n`;
                    text += `  Contact: ${p.contact}\n\n`;
                });
                text += '\n';
            });
            copyToClipboard(text);
        }
        
        function exportAll() {
            let text = 'üìã BRAMILY NYC - COMPLETE DIRECTORY\nBrandi Carlile @ MSG ‚Ä¢ Feb 13-14, 2026\n' + '='.repeat(50) + '\n\n';
            const sorted = [...people].sort((a,b) => (a.name || '').localeCompare(b.name || ''));
            sorted.forEach(p => {
                text += `${p.name}\n`;
                if (p.nights === 'friday' || p.nights === 'both') {
                    text += `  Friday: Section ${p.fridaySection} ${p.fridayRow ? 'Row ' + p.fridayRow : ''} ${p.fridaySeat ? 'Seat ' + p.fridaySeat : ''}`;
                    if (p.fridayVIP !== 'none') text += ` (VIP: ${p.fridayVIP})`;
                    text += '\n';
                }
                if (p.nights === 'saturday' || p.nights === 'both') {
                    text += `  Saturday: Section ${p.saturdaySection} ${p.saturdayRow ? 'Row ' + p.saturdayRow : ''} ${p.saturdaySeat ? 'Seat ' + p.saturdaySeat : ''}`;
                    if (p.saturdayVIP !== 'none') text += ` (VIP: ${p.saturdayVIP})`;
                    text += '\n';
                }
                text += `  Hotel: ${p.hotel}\n  Contact: ${p.contact}\n`;
                if (p.notes) text += `  Notes: ${p.notes}\n`;
                text += '\n';
            });
            copyToClipboard(text);
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('üìã Copied to clipboard!');
            }).catch(() => {
                alert(text);
            });
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>